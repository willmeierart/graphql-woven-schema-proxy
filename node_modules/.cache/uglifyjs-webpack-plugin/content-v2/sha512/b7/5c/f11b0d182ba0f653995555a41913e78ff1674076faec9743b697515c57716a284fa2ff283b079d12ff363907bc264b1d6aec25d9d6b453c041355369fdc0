{"code":"!function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.r=function(e){Object.defineProperty(e,\"__esModule\",{value:!0})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,\"a\",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p=\"\",t.w={},t(t.s=15)}([function(e,r){e.exports=require(\"lodash\")},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0}),r.default={PRIMARY:{address:\"https://api.graphcms.com/simple/v1/cjfipt3m23x9i0190pgetwf8c\"},SECONDARY:{address:\"https://api.graphcms.com/simple/v1/cjfipwwve7vl901427mf2vkog\"}}},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0}),r.compareSemVer=function(e,r){const t=e.split(\".\"),o=r.split(\".\");for(var s=0;s<3;s+=1){const e=Number(t[s]),r=Number(o[s]);if(e>r)return 1;if(r>e)return-1;if(!(0,n.isNaN)(e)&&(0,n.isNaN)(r))return 1;if((0,n.isNaN)(e)&&!(0,n.isNaN)(r))return-1}return 0};var n=t(0)},function(e,r){e.exports=require(\"@workpop/simple-logger\")},function(e,r){e.exports=require(\"graphql-server-express\")},function(e,r){e.exports=require(\"apollo-fetch\")},function(e,r){e.exports=require(\"graphql\")},function(e,r){e.exports=require(\"graphql-tools\")},function(e,r){e.exports=require(\"body-parser\")},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var n=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e};let o=(s=g(function*({uri:e,introspectPromise:r}){return{[e]:yield r}}),function(e){return s.apply(this,arguments)});var s;let i=(u=g(function*({SERVICE_CONFIG:e,customHeaders:r}){const t=function({SERVICE_CONFIG:e,customHeaders:r}){return(0,p.reduce)(e,(e,t)=>{const n=(0,p.get)(t,\"address\"),s=(0,l.createApolloFetch)({uri:n});return s.use(({request:e,options:t},n)=>{t.headers||(t.headers={}),t.headers=r,n()}),e.push(o({uri:n,introspectPromise:(0,a.introspectSchema)(s)})),e},[])}({SERVICE_CONFIG:e,customHeaders:r}),s=yield Promise.all(t);return(0,p.reduce)(s,function(e,r){const t=(0,p.head)((0,p.keys)(r)),o=(0,l.createApolloFetch)({uri:t});o.use(function({request:e,options:r={}},t){const n=(0,p.get)(e,\"context.graphqlContext.headers\",{});r.headers||(r.headers={}),r.headers=n,t()});const s=(0,a.makeRemoteExecutableSchema)({schema:(0,p.head)((0,p.values)(r)),fetcher:o});return n({},{[t]:s},e)},{})}),function(e){return u.apply(this,arguments)});var u,c=v(t(8)),a=t(7),f=t(6),l=t(5),p=t(0),d=t(4),h=v(t(3)),m=t(2);function v(e){return e&&e.__esModule?e:{default:e}}function g(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function n(o,s){try{var i=r[o](s),u=i.value}catch(e){return void t(e)}if(!i.done)return Promise.resolve(u).then(function(e){n(\"next\",e)},function(e){n(\"throw\",e)});e(u)}(\"next\")})}}const x=new h.default(\"GRAPHQLPROXY\");function y(e){const r=e.match(/VERSION:(.*)$/gm);if(r)return function(e){return(0,p.last)(e.split(\":\"))}((0,p.head)(r))}r.default=(()=>{var e=g(function*({SERVICE_CONFIG:e,server:r,customHeaders:t={},headersToForward:o,enableGraphiql:s=!1,errorFormatter:u}){const l=yield i({SERVICE_CONFIG:e,customHeaders:t}),v=(0,p.values)(l);let q;try{q=(0,a.mergeSchemas)({schemas:v,onTypeConflict:function(e,r){const t=y(e&&e.description),n=y(r&&r.description);if(t&&n){x.info(\"Versions found comparing\",t,n);const o=(0,m.compareSemVer)(t,n);if(1===o)return e;if(-1===o)return r}return t&&!n?(x.info(\"Only leftTypeVersion found\",t),e):!t&&n?(x.info(\"Only rightTypeVersion found\",n),r):(x.info(\"No versions found picking leftType\"),e)}}),r.use(\"/graphql\",c.default.json(),(0,d.graphqlExpress)((O=g(function*(r){let s;const i=r.headers[\"x-request-id\"];s=i?new h.default(\"GRAPHQLPROXY\",i):new h.default(\"GRAPHQLPROXY\");const c={context:{config:e},formatError:u||function(e){return s.error(e.message),{message:e.message}}};i&&(s.info(\"Request Id:\",i),c.context.requestId=i);const a=r.body.query,l=r.body.operationName,d=r.body.variables;a&&function(e){const r=(0,f.parse)(e);(0,p.each)((0,p.get)(r,\"definitions\"),e=>{const r=(0,p.get)(e,\"selectionSet\"),t=(0,p.get)(r,\"selections\");(0,p.each)(t,e=>{const r=(0,p.get)(e,\"name.value\");x.info(\"Resolver name from selection set:\",r)})})}(a),l&&s.info(\"GraphQL Operation Name:\",l),d&&s.info(\"GraphQL Variables:\",d);const m=r.headers.userid||r.headers[\"wp-userid\"],v=r.headers.cookie,g=o&&(0,p.pick)(r.headers,...o);return m&&(s.trace(`Recieving request from UserId ${m}`),c.context.userId=m),c.context.headers=n({},g,t,{userId:m,requestId:i,\"wp-userid\":m,cookie:v}),c.schema=q,c}),function(e){return O.apply(this,arguments)}))),s&&r.use(\"/graphiql\",(0,d.graphiqlExpress)({endpointURL:\"/graphql\"}))}catch(e){return x.error(e)}var O});return function(r){return e.apply(this,arguments)}})()},function(e,r,t){\"use strict\";const n=t(9);e.exports=n},function(e,r){e.exports=require(\"compression\")},function(e,r){e.exports=require(\"express\")},function(e,r){e.exports=require(\"babel-polyfill\")},function(e,r,t){\"use strict\";t(13);var n=i(t(12)),o=(i(t(11)),i(t(10))),s=i(t(1));function i(e){return e&&e.__esModule?e:{default:e}}const u=(0,n.default)();(0,o.default)({SERVICE_CONFIG:s.default,server:u,enableGraphiql:!0}).then(()=>{u.listen(3010,()=>{console.log(\"RUNNING PROXY ON 3010\")})})},function(e,r,t){\"use strict\";const n=t(14);e.exports=n}]);","extractedComments":[]}